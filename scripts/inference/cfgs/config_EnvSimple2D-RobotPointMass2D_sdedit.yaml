model_dir_ddpm_bspline: '${HOME}/Projects/MotionPlanningDiffusion/mpd-splines/data_trained_models/launch_train_diffusion_models-v04_2024-09-17_21-44-17/generative_model_class___GaussianDiffusionModel/dataset_subdir___EnvSimple2D-RobotPointMass2D-joint_joint-one-RRTConnect/dataset_file_merged___dataset_merged_doubled.hdf5/context_ee_goal_pose___False/unet_input_dim___32/unet_dim_mults_option___0/context_q_out_dim___32/context_ee_goal_pose_out_dim___32/context_combined_out_dim___32/bspline_num_control_points_desired___18/parametric_trajectory_class___ParametricTrajectoryBspline/0'

model_selection: 'bspline'

#######################################################################################################################
# minimum distance between start and goal configurations
min_distance_q_pos_start_goal: 1.4

# environment options
env_id_replace: null
grasped_object: null

# collision avoidance/checking options
obstacle_cutoff_margin_extra: 0.02
margin_for_dense_collision_checking: 0.0

#######################################################################################################################
# task options
num_T_pts: 128
trajectory_duration: 10.0
phase_time_class: 'PhaseTimeLinear'
project_gradient_hierarchy: false

costs:
  CostTaskSpaceCollisionObjects:
    weight: 10.0
    use_only_on_extra_objects: false
  CostJointSpaceJointLimits:
    weight: 1.0
  CostJointSpaceVelocity:
    weight: 0.01
  CostJointSpaceAcceleration:
    weight: 0.001

n_trajectory_samples: 100

best_trajectory_selection: 'shortest_path_length'

#######################################################################################################################
# Planner options — use MPD (diffusion + guide) for SDEdit to leverage cost guidance
planner_alg: 'mpd'

diffusion_sampling_method: 'ddim'

compute_costs_with_xrecon: false
n_diffusion_steps_without_noise: 0
extra_mp_steps: 0

# ddim options
ddim:
  t_start_guide_steps_fraction: 0.3
  ddim_sampling_timesteps: 15
  ddim_eta: 0.3  # lower eta for SDEdit to preserve input path structure
  ddim_skip_type: 'quadratic'
  ddim_scale_grad_prior: 0.25
  n_guide_steps: 4
  guide_lr: 1.0
  max_perturb_x: 0.15
  clip_grad: true
  clip_grad_rule: 'value'
  max_grad_norm: 1.
  max_grad_value: 1.

# ddpm options (if using ddpm instead)
ddpm:
  t_start_guide_steps_fraction: 0.2
  prior_weight_with_guide: 0.95
  noise_std: 0.7
  n_guide_steps: 2
  guide_lr: 0.1
  max_perturb_x: 0.15
  clip_grad: true
  clip_grad_rule: 'value'
  max_grad_norm: 1.
  max_grad_value: 1.

#######################################################################################################################
# SDEdit-specific options

sdedit:
  # Noise level: DDIM step index to start denoising from.
  # 0 = start from noisiest (equivalent to full generation)
  # 7 = moderate noise (good starting point for re-planning)
  # 14 = barely noised (minimal change from input)
  t_noise_level: 7

  # Mode: 'replan' or 'sketch'
  # replan: valid path + modified obstacles → regenerate
  # sketch: illegal path → denoise to make legal
  mode: 'replan'

  # Obstacle modification (for replan mode)
  # 'add_sphere': add a sphere obstacle
  # 'remove_sphere': remove a sphere obstacle by index
  # null: no obstacle modification (sketch mode)
  obstacle_modification:
    type: 'add_sphere'
    center: [0.0, 0.0]
    radius: 0.15
